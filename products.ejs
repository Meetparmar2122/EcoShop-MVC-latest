<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title><%= title %></title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 40px; }
    h1 { margin-bottom: 10px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 16px; }
    .card { border: 1px solid #e2e2e2; border-radius: 14px; padding: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .price { font-weight: 700; }
    form.inline { display: inline; }
    .add { margin-top: 24px; padding: 16px; border: 1px dashed #999; border-radius: 14px; }
    input, button, select { padding: 8px 10px; border-radius: 10px; border: 1px solid #ccc; }
    .actions { display: flex; gap: 8px; align-items: center; }
    .muted { color: #777; font-size: 12px; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    @media (max-width: 640px) { .row { grid-template-columns: 1fr; } }
    .socket-box { margin-top: 30px; padding: 16px; border: 1px solid #ccc; border-radius: 10px; background: #f9f9f9; }
  </style>
</head>
<body>
  <h1>EcoShop Products</h1>
  <p class="muted">MVC Demo · Model=Mongoose · View=EJS · Controller=Express handlers</p>

  <% if (products.length === 0) { %>
    <p>No products yet. Add your first product below.</p>
  <% } else { %>
    <div class="grid">
      <% products.forEach(p => { %>
        <div class="card">
          <strong><%= p.name %></strong><br/>
          <span class="price">$<%= (p.price || 0).toFixed(2) %></span>
          <div class="muted"><%= p.category %></div>
          <p><%= p.description %></p>
          <div class="actions">
            <form class="inline" method="POST" action="/products/delete/<%= p._id %>">
              <button type="submit">Delete</button>
            </form>
          </div>
        </div>
      <% }) %>
    </div>
  <% } %>

  <div class="add">
    <h2>Add Product</h2>
    <form method="POST" action="/products/add">
      <div class="row">
        <input name="name" placeholder="Name" required />
        <input type="number" step="0.01" name="price" placeholder="Price" required />
        <input type="number" name="stock" placeholder="Stock" />
        <input name="category" placeholder="Category" value="General" />
      </div>
      <p><textarea name="description" rows="3" style="width:100%" placeholder="Description"></textarea></p>
      <button type="submit">Add Product</button>
    </form>
  </div>

  <p class="muted">JSON API: <a href="/products/api">/products/api</a></p>

  <!-- Socket.IO Demo Section -->
  <div class="socket-box">
    <h2>Live Socket.IO Demo</h2>
    <p>Random number from server: <strong id="number">--</strong></p>
  </div>

  <!-- Load Socket.IO -->
  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io(); // auto-connects to server

    // Listen for random numbers from server
    socket.on('number', (msg) => {
      console.log('Random number from server:', msg);
      document.getElementById('number').innerText = msg;
    });
  </script>
</body>
</html>
